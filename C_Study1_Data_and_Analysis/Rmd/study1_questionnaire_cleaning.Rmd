---
title: "Study 1 Questionnaire Cleaning"
author: "Chisom Obasih"
date: "March 2025"
subtitle: "Raw data cleaning and wrangling of Linguistic Diversity Questionnaire (LDQ) data from Study 1"

output: 
  pdf_document:
    latex_engine: xelatex
    includes:
      in_header: "/Users/chisomobasih/Exp-Research/General/wrap-code.tex"
editor_options: 
  chunk_output_type: inline
---

Helpful code to remember:
str() to look at the structure of a dataframe
summary() to summarize (mean, factors, count, etc.) of vector or dataframe
typeof() to view type of vector

helpful hotkeys to remember:
cmd+shift+m = %>%
cmd+opt+i = new chunk

# Libraries
```{r load-libraries}
suppressPackageStartupMessages(library(tidyverse))
library(janitor)
library(rio)
library(ggthemes)
library(ggpubr)
library(rstatix)
library(lmerTest)
library(psycho)
library(knitr)

library(conflicted)
# package to solve conflicts between functions of different packages that use the same name
# use dplyr for all functions in the case of conflict between packages, output suppressed
conflict_prefer_all("dplyr", quiet = TRUE)
# use lmerTest for the following functions in the case of conflict between packages
conflict_prefer("lmer", "lmerTest")

# avoid scientific notation
options(scipen = 999)
```

------------------------------------------------------------------------


# Read in data

```{r read-data, message = FALSE}
# questionnaire data within subfolder of raw_data
# data.path <- "raw_data/questionnaires"

ldq <- import(file = "raw_data/questionnaires/LDQ_long.csv")
```

----------------------------------------------
# Cleaning

Part 1 questions based on LHQ3

Page 3 = "7.Indicate your native language(s) and any other languages you have studied or learned, the age at which you started using each language in terms of listening, speaking, reading, and writing, and the total number of years you have spent using each language."
Page 4 = "10.If you have lived or traveled in countries other than your country of residence for three months or more, then indicate the name of the country, your length of stay (in Months), the language you used, and the frequency of your use of the language for each country."
Page 5 = "11.Indicate the way you learned or acquired your non-native language(s). Check one or more boxes that apply."
Page 6 = "12.Indicate the age at which you started using each of the languages you have studied or learned in the following environments (Including native language)."
Page 7 = "13.Indicate the language used by your teachers for instruction at each educational level. If the instructional language switched during any educational level, then also indicate the "Switched to" language. If you had a bilingual education at any educational level, then simply check the box under "Both Languages"."
Page 8 = "15.Rate your current ability in terms of listening, speaking, reading, and writing in each of the languages you have studied or learned (including the native language)."
Page 9 = "18.Estimate how many hours per day you spend engaged in the following activities in each of the languages you have studied or learned (including the native language)."
Page 10 = "19.Estimate how many hours per day you spend speaking with the following groups of people in each of the languages you have studied or learned (including the native language)."
Page 11 = "21.In which language do you communicate best or feel most comfortable in terms of listening, speaking, reading, and writing in each of the following environments? You may be selecting the same language for all or some of the fields below."
Page 12 = "23.What percentage of your friends speaks each of the languages you have studied or learned? (including the native language)"
Page 13_11. = "25.Use the comment box below to indicate any additional answers to any of the questions above that you feel better describe your language background or usage."
Page 13_12. = "27.Do you also speak/use any dialects of the languages you know? Please indicate the name(s) of the dialect and the degree you use them."

Part 2 questions are on pages 15, 16, 17
------------------------------------------------------------------------

```{r initial-data-wrangling}
# LDQ data wrangling
# clean up long format of questionnaire to select relevant columns, and clean up certain column values in preparation for pivoting data to wide format

ldq_long <- ldq %>%
  select(
    # select only the relevant columns
    `Participant Private ID`,
    `Page`,
    `Question`,
    `Key`,
    `Response Type`,
    `Response`,
    `Object Name`,
    `Store: Language-1`,
    `Store: Language-2`,
    `Store: Language-3`,
    `Store: Language-4`
  ) %>%
  # filter for only the rows that contain a possible response
  filter(`Response Type` == "response") %>%
  # filter OUT any rows were the Response is a quantised version of the response value
  filter(!str_detect(`Key`, "quantised")) %>%
  # rename some columns
  rename(`ID` = `Participant Private ID`, `Language 1` = `Store: Language-1`, `Language 2` = `Store: Language-2`, `Language 3` = `Store: Language-3`, `Language 4` = `Store: Language-4`) %>%
  # change the ID column to be character to remove "1287" from all ID (making the ID shorter and more manageable)
  mutate(`ID` = as.factor(str_remove(as.character(ID), "1287"))) %>%
  # because of formatting on Gorilla, some objects don't have an actual question in the Question column, so I will adjust those to contain all the necessary information needed for when the df pivots wider, as the current values in the Question column will become the column names
  # the Question column denotes the sub-question
  mutate(`Question` = case_when(
    # Page 2 questions
    `Question` == "Please enter your age:" ~ "age",
    `Question` == "Please specify your gender identity:" ~ "gender",
    # Page 3 questions (also for Page 8 questions)
    `Key` == "Language 1-value" | `Key` == "Language 2-value" | `Key` == "Language 3-value" | `Key` == "Language 4-value" ~ "lang",
    `Key` == "Listening-value" ~ "L", 
    `Key` == "Speaking-value" ~ "S",
    `Key` == "Reading-value" ~ "R",
    `Key` == "Writing-value" ~ "W",
    `Key` == "Years of use-value" ~ "YoU",
    # Page 4 questions
    `Key` == "Country 1-value" | `Key` == "Country 2-value" | `Key` == "Country 3-value" | `Key` == "Country 4-value" ~ "country",
    `Key` == "Length of stay (in months)-value" ~ "length_of_stay",
    `Page` == "Page 4" & `Key` == "Language-value" ~ "lang",
    `Question` == "Frequency of use" ~ "lang_frequency",
    # Page 5 questions
    `Page` == "Page 5" & str_detect(`Question`, "Non-native language") ~ "lang",
    `Page` == "Page 5" & str_detect(`Key`, "Immersion") ~ "immersion",
    `Page` == "Page 5" & str_detect(`Key`, "Classroom instruction") ~ "classroom_instruction",
    `Page` == "Page 5" & str_detect(`Key`, "Self-learning") ~ "self_learning",
    # Page 6 questions
    `Key` == "At home-value" ~ "at_home", 
    `Key` == "With friends-value" ~ "with_friends",
    `Key` == "At school-value" ~ "at_school",
    `Key` == "At work-value" ~ "at_work",
    `Key` == "Language software-value" ~ "lang_software", 
    `Key` == "Online games-value" ~ "online_games",
    # Page 7 questions
    `Page` == "Page 7" & `Key` == "Language-value" ~ "lang",
    `Page` == "Page 7" & `Key` == "(Switched to)-value" ~ "switched_to_lang",
    `Page` == "Page 7" & `Key` == "Both languages" ~ "both_langs",
    # Page 9 questions - with LSRW aspects
    `Key` == "Watching television-value" ~ "TV_L",
    `Key` == "Listening to radio-value" ~ "radio_L",
    `Key` == "Reading for fun-value" ~ "fun_R",
    `Key` == "Reading for school/work-value" ~ "school_work_R",
    `Key` == "Using social media and internet-value" ~ "social_internet_W",
    `Key` == "Writing for school/work-value" ~ "school_work_W",
    # Page 10 questions - some have LSRW aspects
    `Key` == "Family members-value" ~ "family_S",
    `Key` == "Friends*-value" ~ "friends_S",
    `Key` == "Classmates-value" ~ "classmates_S",
    `Key` == "Others (co-workers**, roommates, etc.)-value" ~ "others_S",
    # Page 11 questions - listing language most comfortable using (object name will have the environment)
    `Page` == "Page 11" & `Question` == "Listening" ~ "L",
    `Page` == "Page 11" & `Question` == "Speaking" ~ "S",
    `Page` == "Page 11" & `Question` == "Reading" ~ "R",
    `Page` == "Page 11" & `Question` == "Writing" ~ "W",
    # Page 12 questions
    `Page` == "Page 12" ~ "percentage",
    # remove parenthesis from all question prompts (i.e. "12) blah blah blah") on pages 13, 16, and 17 - this replaces only the first instance with "." (i.e. "12. blah blah blah")
    `Page` == "Page 13" | `Page` == "Page 16" | `Page` == "Page 17" ~ str_replace(`Question`, "\\)", "\\."),
    .default = `Question`
    )) %>%
  # remove asterisk from any questions that have them
  mutate(`Question` = str_remove_all(`Question`, "\\*")) %>%
  # for those rows for Page 5, change the Response to be equal to the question name if the value was 1, and blank if the value was 0
  mutate(`Response` = case_when(
    `Page` == "Page 5" & `Response` == 1 ~ `Question`,
    `Page` == "Page 5" & `Response` == 0 ~ NA,
    .default = `Response`
  )) %>%
  # change the object names to reflect language/country counter for sub-questions or to distinguish environment for sub-question, and other clean-up
  mutate(`Object Name` = case_when(
    `Question` == "age" ~ "age",
    `Question` == "gender" ~ "gender",
    # language counters (applies for Page 3, Page 6, Page 8, Page 9, Page 10, Page 12)
    `Object Name` == "Language 1" ~ "lang1",
    `Object Name` == "Language 2" ~ "lang2",
    `Object Name` == "Language 3" ~ "lang3",
    `Object Name` == "Language 4" ~ "lang4",
    # Page 4 - country counter
    `Page` == "Page 4" & str_detect(`Object Name`, "Country 1") ~ "country1",
    `Page` == "Page 4" & str_detect(`Object Name`, "Country 2") ~ "country2",
    `Page` == "Page 4" & str_detect(`Object Name`, "Country 3") ~ "country3",
    `Page` == "Page 4" & str_detect(`Object Name`, "Country 4") ~ "country4",
    # Page 5 - non-native language counter
    `Page` == "Page 5" & str_detect(`Key`, "language 1") ~ "non_native_lang1",
    `Page` == "Page 5" & str_detect(`Key`, "language 2") ~ "non_native_lang2",
    `Page` == "Page 5" & str_detect(`Key`, "language 3") ~ "non_native_lang3",
    `Page` == "Page 5" & str_detect(`Key`, "language 4") ~ "non_native_lang4",
    `Page` == "Page 5" & `Object Name` == "Non-native language 1" ~ "non_native_lang1",
    `Page` == "Page 5" & `Object Name` == "Non-native language 2" ~ "non_native_lang2",
    `Page` == "Page 5" & `Object Name` == "Non-native language 3" ~ "non_native_lang3",
    `Page` == "Page 5" & `Object Name` == "Non-native language 4" ~ "non_native_lang4",
    # Page 7 - school environment - some are capitalized, some not, so just using rest of the word
    str_detect(`Object Name`, "lementary school") ~ "elem",
    str_detect(`Object Name`, "iddle school") ~ "middle",
    str_detect(`Object Name`, "igh school") ~ "high",
    str_detect(`Object Name`, "ollege") ~ "college",
    str_detect(`Object Name`, "aster") ~ "master",
    str_detect(`Object Name`, "octor") ~ "doctor",
    # Page 11 - distinguish environment
    str_detect(`Object Name`, "At home") ~ "at_home",
    str_detect(`Object Name`, "At school") ~ "at_school",
    str_detect(`Object Name`, "At work") ~ "at_work",
    str_detect(`Object Name`, "With friends") ~ "with_friends",
    # clean up object names Page 13, 15, and 17 by converting to snake case (change to lower case and replace non-letter and non-digit characters (spaces, slashes, etc.) with underscore)
    `Page` == "Page 13" | `Page` == "Page 15" | `Page` == "Page 17" ~ snakecase::to_any_case(`Object Name`, "snake"),
    # clean up page 16 questions/object names so that they do not result in list values for response column when widening the dataframe
    `Page` == "Page 16" & str_detect(`Key`, "Language 1") ~ paste(snakecase::to_any_case(`Object Name`, "snake"), "lang1", sep = "_"),
    `Page` == "Page 16" & str_detect(`Key`, "Hours:-2") ~ paste(snakecase::to_any_case(`Object Name`, "snake"), "lang1_hours", sep = "_"),
    `Page` == "Page 16" & str_detect(`Key`, "Language 2") ~ paste(snakecase::to_any_case(`Object Name`, "snake"), "lang2", sep = "_"),
    `Page` == "Page 16" & str_detect(`Key`, "Hours:-4") ~ paste(snakecase::to_any_case(`Object Name`, "snake"), "lang2_hours", sep = "_"),
    `Page` == "Page 16" & str_detect(`Key`, "Language 3") ~ paste(snakecase::to_any_case(`Object Name`, "snake"), "lang3", sep = "_"),
    `Page` == "Page 16" & str_detect(`Key`, "Hours:-6") ~ paste(snakecase::to_any_case(`Object Name`, "snake"), "lang3_hours", sep = "_"),
    `Page` == "Page 16" & str_detect(`Key`, "Language 4") ~ paste(snakecase::to_any_case(`Object Name`, "snake"), "lang4", sep = "_"),
    `Page` == "Page 16" & str_detect(`Key`, "Hours:-8") ~ paste(snakecase::to_any_case(`Object Name`, "snake"), "lang4_hours", sep = "_"),
    .default = `Object Name`
  )) %>%
    # create a new column, based on the Page column, which denotes the question category label
    # page 3 = question 7, page 8 = question 15, page 9 = question 18, page 10 = question 19 - questions that are used in aggregate scoring
  mutate(.before = `Question`, `Question Label` = case_when(
    `Page` == "Page 3" ~ "aoa",
    `Page` == "Page 4" ~ "foreign_countries",
    `Page` == "Page 5" ~ "non_native_acquired",
    `Page` == "Page 6" ~ "aoa_environments",
    `Page` == "Page 7" ~ "education",
    `Page` == "Page 8" ~ "proficiency",
    `Page` == "Page 9" ~ "hours_activities",
    `Page` == "Page 10" ~ "hours_people",
    `Page` == "Page 11" ~ "preferred_lang",
    `Page` == "Page 12" ~ "friends",
    `Page` == "Page 13" & `Object Name` == "question_11" ~ "additional_info",
    `Page` == "Page 13" & `Object Name` == "question_12" ~ "dialects",
    `Page` == "Page 15" ~ "context_hours",
    `Page` == "Page 16" ~ "passive",
    `Page` == "Page 17" & `Object Name` == "question_15" ~ "hours_awake",
    `Page` == "Page 17" & `Object Name` == "question_16" ~ "other_info_part_2",
    .default = NA
  )) %>%
  # replace the question 11 and 12 from page 13 since they're too long to be used in the new column names once the df pivots wider
  mutate(`Question` = ifelse(`Page` == "Page 13", "comment", `Question`)) %>%
  # replace the following values with NA across all character columns
  mutate(across(where(is.character), ~ replace(., . %in% c("", " ", "na", "n/a", "NA", "N/A", "-1", "xxx", "xxx ", "XXX"), NA)))


# separate into parts 1 and 2
# part 2 questions are on pages 15, 16, and 17
ldq_long_part1 <- ldq_long %>%
  filter(!(`Page` %in% c("Page 15", "Page 16", "Page 17")))  %>%
  # some people input responses to some of the sub-questions for languages 2, 3, 4 despite not reporting more than 1 language (or putting 0 for the language name and not reporting more information) so I will replace those values with NA
  mutate(`Response` = case_when(
    `Object Name` == "lang2" & is.na(`Language 2`) ~ NA,
    `Object Name` == "lang2" & `Language 2` == "0" ~ NA,
    `Object Name` == "lang3" & is.na(`Language 3`) ~ NA,
    `Object Name` == "lang3" & `Language 3` == "0" ~ NA,
    `Object Name` == "lang4" & is.na(`Language 4`) ~ NA,
    `Object Name` == "lang4" & `Language 4` == "0" ~ NA,
    .default = `Response`))

ldq_long_part2 <- ldq_long %>%
  filter(`Page` %in% c("Page 2", "Page 15", "Page 16", "Page 17"))
```


```{r pivot-wider-part-1}
# part 1
# pivot to wide
# add language label columns as necessary, using mutate to copy columns to new positions

ldq_wide_part1 <- ldq_long_part1 %>%
  pivot_wider(id_cols = `ID`, names_from = c(`Question Label`, `Question`, `Object Name`), values_from = `Response`) %>%
  # rename age and gender columns
  rename(age = "NA_age_age", gender = "NA_gender_gender") %>%
  # sub ID 5724, did not supply actual language names (just put 0), but specified English in question 11, so will replace "aoa_lang_lang1" with "English" for this subject
  mutate(aoa_lang_lang1 = ifelse(ID == "5724" & aoa_lang_lang1 == "0", "English", aoa_lang_lang1)) %>%
  # add columns for languages 1, 2, 3, 4
  mutate(language1 = aoa_lang_lang1, .after = gender) %>%
  mutate(language2 = aoa_lang_lang2, .after = language1) %>%
  mutate(language3 = aoa_lang_lang3, .after = language2) %>%
  mutate(language4 = aoa_lang_lang4, .after = language3) %>%
  # move some columns around from non_native_acquired
  relocate(non_native_acquired_lang_non_native_lang2, .before = non_native_acquired_immersion_non_native_lang2) %>%
  relocate(non_native_acquired_lang_non_native_lang3, .before = non_native_acquired_immersion_non_native_lang3) %>%
  relocate(non_native_acquired_lang_non_native_lang4, .before = non_native_acquired_immersion_non_native_lang4) %>%
  # create new columns to re-list Languages 1, 2, 3, 4 before sub-questions on Page 6 (aoa_environments), Page 8 (proficiency), Page 9 (hours_activities), Page 10 (hours_people), and Page 12 (friends)
  # page 6 (aoa_environments)
  mutate(aoa_environments_lang_lang1 = aoa_lang_lang1, .before = aoa_environments_at_home_lang1) %>%
  mutate(aoa_environments_lang_lang2 = aoa_lang_lang2, .before = aoa_environments_at_home_lang2) %>%
  mutate(aoa_environments_lang_lang3 = aoa_lang_lang3, .before = aoa_environments_at_home_lang3) %>%
  mutate(aoa_environments_lang_lang4 = aoa_lang_lang4, .before = aoa_environments_at_home_lang4) %>%
  # page 8 (proficiency)
  mutate(proficiency_lang_lang1 = aoa_lang_lang1, .before = proficiency_L_lang1) %>%
  mutate(proficiency_lang_lang2 = aoa_lang_lang2, .before = proficiency_L_lang2) %>%
  mutate(proficiency_lang_lang3 = aoa_lang_lang3, .before = proficiency_L_lang3) %>%
  mutate(proficiency_lang_lang4 = aoa_lang_lang4, .before = proficiency_L_lang4) %>%
  # page 9 (hours_activities)
  mutate(hours_activities_lang_lang1 = aoa_lang_lang1, .before = hours_activities_TV_L_lang1) %>%
  mutate(hours_activities_lang_lang2 = aoa_lang_lang2, .before = hours_activities_TV_L_lang2) %>%
  mutate(hours_activities_lang_lang3 = aoa_lang_lang3, .before = hours_activities_TV_L_lang3) %>%
  mutate(hours_activities_lang_lang4 = aoa_lang_lang4, .before = hours_activities_TV_L_lang4) %>%
  # page 10 (hours_people)'
  mutate(hours_people_lang_lang1 = aoa_lang_lang1, .before = hours_people_family_S_lang1) %>%
  mutate(hours_people_lang_lang2 = aoa_lang_lang2, .before = hours_people_family_S_lang2) %>%
  mutate(hours_people_lang_lang3 = aoa_lang_lang3, .before = hours_people_family_S_lang3) %>%
  mutate(hours_people_lang_lang4 = aoa_lang_lang4, .before = hours_people_family_S_lang4) %>%
  # page 12 (friends)
  mutate(friends_lang_lang1 = aoa_lang_lang1, .before = friends_percentage_lang1) %>%
  mutate(friends_lang_lang2 = aoa_lang_lang2, .before = friends_percentage_lang2) %>%
  mutate(friends_lang_lang3 = aoa_lang_lang3, .before = friends_percentage_lang3) %>%
  mutate(friends_lang_lang4 = aoa_lang_lang4, .before = friends_percentage_lang4) %>%
  # some of the language 2, 3, 4 sub questions for pages 6 (aoa_environments), 8 (proficiency), 9 (hours_activities), 10 (hours_people), and 12 (friends) are out of order, so need to relocate them in the proper order
  relocate(c(aoa_environments_lang_lang2:aoa_environments_online_games_lang3, aoa_environments_lang_lang4:aoa_environments_online_games_lang4), .after = aoa_environments_online_games_lang1) %>%
  relocate(c(proficiency_lang_lang2:proficiency_W_lang3, proficiency_lang_lang4:proficiency_W_lang4), .after = proficiency_W_lang1) %>%
  relocate(c(hours_activities_lang_lang2:hours_activities_school_work_W_lang3, hours_activities_lang_lang4:hours_activities_school_work_W_lang4), .after = hours_activities_school_work_W_lang1) %>%
  relocate(c(hours_people_lang_lang2:hours_people_others_S_lang3, hours_people_lang_lang4:hours_people_others_S_lang4), .after = hours_people_others_S_lang1) %>%
  relocate(c(friends_lang_lang2:friends_percentage_lang3, friends_lang_lang4:friends_percentage_lang4), .after = friends_percentage_lang1) %>%
  # move questions 11 and 12 to the end
  relocate(c(additional_info_comment_question_11:dialects_comment_question_12), .after = last_col())

  

```

```{r save-unfiltered-wide-part1-data}
# save unfiltered 
write_excel_csv(ldq_wide_part1, file = "clean_data/study1_ldq_wide_part1_all.csv")
  
```

```{r pivot-wider-part-2}
# part 2
# pivot to wide

ldq_wide_part2 <- ldq_long_part2 %>%
  pivot_wider(id_cols = `ID`, names_from = c(`Question Label`, `Object Name`), values_from = `Response`) %>%
  # rename age and gender columns
  rename(age = "NA_age", gender = "NA_gender") %>%
  # rearrange columns
  relocate(context_hours_listening, .before = passive_listening_lang1) %>%
  relocate(context_hours_games, .before = passive_games_lang1) %>%
  relocate(context_hours_internet, .before = passive_internet_lang1) %>%
  relocate(context_hours_home, .before = passive_home_lang1) %>%
  relocate(context_hours_family, .before = passive_family_lang1) %>%
  relocate(context_hours_social, .before = passive_social_lang1) %>%
  relocate(context_hours_work_school, .before = passive_work_school_lang1) %>%
  relocate(context_hours_out_of_home, .before = passive_out_of_home_lang1) %>%
  relocate(context_hours_other:context_hours_other_please_specify, .before = passive_other_lang1)

```


```{r save-unfiltered-wide-part2-data}
# save unfiltered 
write_excel_csv(ldq_wide_part2, file = "clean_data/study1_ldq_wide_part2_all.csv")
  
```


```{r wide-data-cleaning}
# remove participants who did not input the correct information (put the name of the language in age of acquisition, put the age of acquisition as the language, etc.)
# or adjust their data if safe assumptions can be made

filtered_part1 <- ldq_wide_part1 %>%
  # coerce applicable columns to numeric/interger %>%
  type.convert() %>%
  # convert ID and gender back to factor
  mutate(ID = as.factor(ID), gender = as.factor(gender))

### categories of data input mistakes ###

## REMOVE FROM DATA ##

# correct AoA but incorrect YoU - REMOVE FROM DATA
# 5190, row 7 - bilingual and cannot extrapolate YoU for either language
# 5885, row 44 - monolingual, but put English for lang2 and lang3, and "0" for lang4 - will filter from data because he put 0 for every aoa_activities, didn't seem to be paying too much attention to give careful answers

# put level instead of AoA - REMOVE FROM DATA
# 5138, row 12 - put level instead of age for AoA

# did not supply language names - REMOVE FROM DATA
# 5465, row 24 - did not supply actual language names, but indicated 4 languages, only listed English and Spanish in question 11, incorrect input of YoU

# put language name instead of AoA - REMOVE FROM DATA
# 5212, row 33 - YoU = NA
# 5847, row 45 - also said "from birth" for YoU, and just put english for all four languages, did not seem to provide quality data
# 5861, row 56 - incorrect input of YoU = 0
# 5966, row 60 - correct input of YoU
# 5707, row 66 - incorrect input of YoU = 0
# 5660, row 68 - correct input of YoU
# 5991, row 70 - incorrect input of YoU = 0
# 6234, row 74 - incorrect input of YoU = 0
# 6840, row 77 - incorrect input of YoU = 0
# 7107, row 91 - correct input of YoU

# other - REMOVE FROM DATA?
# 6046, row 61 - put AoA as 26 and 23 for reading writing - not sure if I should subtract that from years of use or what - so will remove from data for now


## KEEP IN DATA ##

# correct AoA but incorrect YoU (YoU = 0) - KEEP IN DATA
# 5565, row 29 - bilingual, but correct input for YoU for language 2, so will assume YoU of language 1 = age
# 5768, row 36 - mostly monolingual, and correct input of YoU for language 2, so will assume YoU of language 1 = age
# 5592, row 37 - monolingual, will assume YoU = age
# 5837, row 42 - monolingual, will assume YoU = age
# 5613, row 48 - monolingual, will assume YoU = age
# 5617, row 53 - monolingual, will assume YoU = age
# 6104, row 54 - monolingual, will assume YoU = age
# 6235, row 63 - monolingual, will assume YoU = age
# 5873, row 65 - monolingual, will assume YoU = age
# 6690, row 75 - monolingual, will assume YoU = age
# 6867, row 76 - functionally monolingual, and correct input of YoU for language 2, so will assume YoU of language 1 = age
# 6998, row 80 - monolingual, will assume YoU = age
# 5238, row 84 - functionally monolingual, and correct input of YoU for language 2, so will assume YoU of language 1 = age
# 6994, row 90 - monolingual, will assume YoU = age
# 7187, row 92 - monolingual, will assume YoU = age
# 7189, row 94 - monolingual, will assume YoU = age
# 7470, row 96 - monolingual, will assume YoU = age

# supplied AoA, did not supply YoU - KEEP IN DATA
# 5570, row 26 - monolingual so will assume YoU = age

# incorrectly used value of YoU for all AoA values, but values for all aspects were equal to age, so can maybe assume AoA is 0 for all aspects, using (age - input) - KEEP IN DATA
# 5549, row 25
# 5838, row 41
# 6045, row 46
# 6015, row 59

# incorrect input of AoA, with different values for different aspects (likely confused YoU with AoA) - KEEP IN DATA
# 6451, row 78 - but monolingual, so can assume AoA is (age - input)

### IDs to filter from part 2 ###

# 5465 - although had interesting data, didn't list actual language names - also removed from part 1
# 6104 - didn't provide any data for page 16
# 5727 - basically didn't provide any data
# 5966 - didn't provide any data for page 16 - also removed from part 1
# 6046 - didn't provide any data for page 16 - also removed from part 1
# 5660 - didn't provide any data for page 16 - also removed from part 1
# 5858 - basically didn't provide any data for page 16
# 6234 - didn't provide any data for page 16 - also removed from part 1
# 7470 - only gave partial data (didn't add native language)



#### create vectors of participants that need to be removed or for whom their data needs changed ####

# these IDs need to be removed from the data based on part 1
remove <- c("5190", "5885", "5138", "5465", "5212", "5847", "5861", "5966", "5707", "5660", "5991", "6234", "6840", "7107", "6046")

# these IDs need aoa_lang1_YoU to be equal to age
you_age <- c("5565", "5768", "5592", "5837", "5613", "5617", "6104", "6235", "5873", "6690", "6867", "6998", "5238", "6994", "7187", "7189", "7470", "5570")

# these IDs need their AoA aspects (R, L, W, S) for lang1 to be equal to (age - [aoa_input])
aoa_subtract <- c("5549", "5838", "6045", "6015", "6451")



filtered_part1 <- ldq_wide_part1 %>%
  filter(!(ID %in% remove), !(ID %in% remove2)) %>%
  mutate(aoa_YoU_lang1 = ifelse(ID %in% you_age, age, aoa_YoU_lang1)) %>%
  mutate(aoa_R_lang1 = ifelse(ID %in% aoa_subtract, (as.numeric(age) - as.numeric(aoa_R_lang1)), aoa_R_lang1)) %>%
  mutate(aoa_L_lang1 = ifelse(ID %in% aoa_subtract, (as.numeric(age) - as.numeric(aoa_L_lang1)), aoa_L_lang1)) %>%
  mutate(aoa_W_lang1 = ifelse(ID %in% aoa_subtract, (as.numeric(age) - as.numeric(aoa_W_lang1)), aoa_W_lang1)) %>%
  mutate(aoa_S_lang1 = ifelse(ID %in% aoa_subtract, (as.numeric(age) - as.numeric(aoa_S_lang1)), aoa_S_lang1)) %>%
    # sub ID 5098 put "Pokemon" for aoa_environments_online_games_lang1 and "Duolingo" for aoa_environments_lang_software_lang2, so replace these values with NA
  mutate(aoa_environments_online_games_lang1 = ifelse(ID == "5098" & aoa_environments_online_games_lang1 == "Pokemon", NA, aoa_environments_online_games_lang1)) %>%
  mutate(aoa_environments_lang_software_lang2 = ifelse(ID == "5098" & aoa_environments_lang_software_lang2 == "Duolingo", NA, aoa_environments_lang_software_lang2)) %>%
  # coerce applicable columns to numeric/interger %>%
  type.convert() %>%
  # convert ID and gender back to factor
  mutate(ID = as.factor(ID), gender = as.factor(gender))
  

```

```{part-2-data-cleaning}
## need to change data in Part 2 ##

filtered_part2 <- ldq_wide_part2 %>%
  filter(!(ID %in% remove)) %>%
  type.convert() %>%
  mutate(ID = as.factor(ID), gender = as.factor(gender))
  
# these three IDs were originally kept in the data depsite part1 mistakes, but must be removed from part2 for the following reasons:

# 5565 - put "24" for context hours home, family, social, work_school, out_of_home - nonsensical so dropped from data
# 5549 - put "45" for context hours work_school - I think he was probably doing hours per week instead of hours per day, but I can't assume so dropped from the data - also put 6 hours for total time spent awake - probably meant sleep, but again, can't assume, so dropped from data
# 6994 - the hours per language reported on page 16 often exceeded the hours reported per context on page 15, resulting in a negative MLD-P value, so dropped from data (more details below in part2-sanity-check)


# the following columns are supposed to be num/int but were originally came out as character columns:
# $passive_family_lang2_hours - row 41, ID == 5613 participant accidentally put "0..3" - so I changed that to value to 0.3
# $passive_family_lang3_hours - row 11, ID == 5341 participant accidentally put "0French" and "0" in $passive_family_lang4, so I assume the value was supposed to be 0 for lang3_hours, "French" for lang4, and "0" for lang4_hours - so I changed those values accordingly

# 5570 - change "-18" for context_hours_games to "18" (confirmed with input for passive_games_lang1_hours), same with "-3" for context_hours_out_of_home needs to be changed to "3" (confirmed with passive_out_of_home_lang1_hours)
# 7189 - change "-2" for context_hours_games to "2" (confirmed with input for passive_games_lang1_hours)

# these IDs need to be removed based on part 2, 5 IDs overlap from part 1
remove2 <- c("5465", "6104", "5727", "5966", "6046", "5660", "5858", "6234", "7470", "5565", "5549", "6994")

filtered_part2 <- ldq_wide_part2 %>%
  filter(!(ID %in% remove), !(ID %in% remove2)) %>%
  mutate(passive_family_lang2_hours = ifelse(ID == "5613" & passive_family_lang2_hours == "0..3", 0.3, passive_family_lang2_hours)) %>%
  mutate(passive_family_lang3_hours = ifelse(ID == "5341" & passive_family_lang3_hours == "0French", 0, passive_family_lang3_hours)) %>%
  mutate(passive_family_lang4 = ifelse(ID == "5341" & passive_family_lang4 == "0", "French", passive_family_lang4)) %>%
  mutate(passie_family_lang4_hours = ifelse(ID == "5341" & is.na(passive_family_lang4_hours), 0, passive_family_lang4_hours)) %>%
  mutate(context_hours_games = ifelse(ID == "5570" & context_hours_games == -18, 18, ifelse(ID == "7189" & context_hours_games == -2, 2, context_hours_games))) %>%
  mutate(context_hours_out_of_home = ifelse(ID == "5570" & context_hours_out_of_home == -3, 3, context_hours_out_of_home)) %>%
  type.convert() %>%
  mutate(ID = as.factor(ID), gender = as.factor(gender))




str(filtered_part2)
# after making these changes, all columns that are supposed to be num or int are properly num or int

# after filtering, n = 76
```


```{r part2-sanity-check}

sanity.check <- filtered_part2 %>%
  group_by(ID) %>%
  summarize(
    watching_discrepency = ifelse(context_hours_watching < passive_watching_lang1_hours, 1, 0),
    listening_discrepency = ifelse(context_hours_listening < passive_listening_lang1_hours, 1, 0),
    games_discrepency = ifelse(context_hours_games < passive_games_lang1_hours, 1, 0),
    internet_discrepency = ifelse(context_hours_internet < passive_internet_lang1_hours, 1, 0),
    home_discrepency = ifelse(context_hours_home < passive_home_lang1_hours, 1, 0),
    family_discrepency = ifelse(context_hours_family < passive_family_lang1_hours, 1, 0),
    social_discrepency = ifelse(context_hours_social < passive_social_lang1_hours, 1, 0),
    work_school_discrepency = ifelse(context_hours_work_school < passive_work_school_lang1_hours, 1, 0),
    out_of_home_discrepency = ifelse(context_hours_out_of_home < passive_out_of_home_lang1_hours, 1, 0),
    other_discrepency = ifelse(context_hours_other < passive_other_lang1_hours, 1, 0))


# from this, the below IDs have issues

check <- filtered_part2 %>%
  filter(ID %in% c(5717, 5341, 5541, 5585, 5873, 6509, 7474, 5178))

# ID == 6994 watching, listening, internet hours discrepancy - watching hours per day = 1, but passive_watching_lang1_hours = 2 (no other languages); listening hours per day = 0, but passive_listening_lang1_hours = 1 (no other languages); games per hour = 3, but English = 2; internet hours = 2 but English = 5; school_work hours = 7, but English = 4 - too mistakes that I can't assume what she meant so REMOVED FROM DATA

# ID == 5717 watching hours discrepancy - context_hours_watching = 0, but English watching = 1 (other watching languages reported at 0 hours) - CHANGED context_hours_watching to =1

# ID == 5341 listening hours discrepancy - context_hours_listening = 0, but English listening hours = 5 (no other languages reported) - CHANGED context_hours_listening to =5

# ID == 5541 games hours discrepancy - games hours = 0 but English hours = 1 (no other games languages reported) - CHANGED context_hours_games changed to =1

# ID == 5585 games hours discrepancy - games hours = 0.5 but English hours = 1 (other games languages reported at 0 hours) - not sure which number I should choose for both values so these values have been CHANGED to NA

# ID == 5873 internet hours discrepancy - internet hours = 1 but English hours = 2 (no other internet languages reported) - not sure which number I should choose for both values so these values have been CHANGED to NA


# ID == 7474 family hours discrepancy - family hours = 6 but English hours = 8 (no other family languages reported) - not sure which number I should choose for both values so these values have been CHANGED to NA

# ID == 6509 home, family hours discrepancy - home hours = 20 but English hours = 24 and Spanish hours = 4; family hours = 4 but English hours = 24 and Spanish hours = 1 - because his pattern of reporting for other contexts is such that English equals the number of hours he reported for the context, I have CHANGED the data to be English home hours = 20 and English family hours = 4 - that seems like a reasonable assumption

# ID == 5178 work_school discrepancy - work_school hours = 8 but English hours = 12 (no other languages reported) - not sure which number I should choose for both values so these values have been CHANGED to NA


updated_filtered_part2 <- filtered_part2 %>%
  mutate(context_hours_watching = ifelse(ID == "5717" & context_hours_watching == 0, 
                                         1, context_hours_watching)) %>%
  mutate(context_hours_listening = ifelse(ID == "5341" & context_hours_listening == 0,
                                          5, context_hours_listening)) %>%
  mutate(context_hours_games = ifelse(ID == "5541" & context_hours_games == 0,
                                      1, ifelse(ID == "5585" & context_hours_games == 0.5, 
                                          NA, context_hours_games))) %>%
  mutate(passive_games_lang1_hours = ifelse(ID == "5585" & passive_games_lang1_hours == 1, 
                                            NA, passive_games_lang1_hours)) %>%
  mutate(context_hours_internet = ifelse(ID == "5873" & context_hours_internet == 1,
                                         NA, context_hours_internet)) %>%
  mutate(passive_internet_lang1_hours = ifelse(ID == "5873" & passive_internet_lang1_hours == 2,
                                               NA, passive_internet_lang1_hours)) %>%
  mutate(context_hours_family = ifelse(ID == "7474" & context_hours_family == 6,
                                       NA, context_hours_family)) %>%
  mutate(passive_family_lang1_hours = ifelse(ID == "7474" & passive_family_lang1_hours == 8, NA,
                                             ifelse(ID == "6509" & context_hours_family == 4 & passive_family_lang1_hours == 24, 4, passive_family_lang1_hours))) %>%
  mutate(passive_home_lang1_hours = ifelse(ID == "6509" & context_hours_home == 20 & passive_home_lang1_hours == 24, 20, passive_home_lang1_hours)) %>%
  mutate(context_hours_work_school = ifelse(ID == "5178" & context_hours_work_school == 8, NA,
                                            context_hours_work_school)) %>%
  mutate(passive_work_school_lang1_hours = ifelse(ID == "5178" & passive_work_school_lang1_hours == 8, NA, passive_work_school_lang1_hours))
  
  
```




```{r save-filtered-data}
# update part1 with part2 filter list and save
updated_filtered_part1 <- filtered_part1 %>%
  filter(!(ID %in% remove), !(ID %in% remove2))

write_excel_csv(updated_filtered_part1, file = "clean_data/study1_ldq_wide_part1_filtered.csv")
  
# save updated filtered data
write_excel_csv(updated_filtered_part2, file =  "clean_data/study1_ldq_wide_part2_filtered.csv")
```






------------------------------------------------------------------------

## Session Info

```{r sessionInfo, results='hide'}
sessionInfo()
```
